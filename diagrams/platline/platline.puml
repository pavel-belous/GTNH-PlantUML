@startuml
scale 1
'skinparam linetype polyline
'skinparam linetype ortho
'left to right direction
skinparam rectangle {
    BackgroundColor<<HV>> #ADABBC
    BackgroundColor<<EV>> #D79DE4
    BackgroundColor<<IV>> #625D98
}

' debug flag
' %true() - display ports names, useful for creating relations
' %false() - dont display ports names
!$DEBUG = %true()

'-----------Functions--------------------------------------------
!function $getGTcircuitImage($circuitNo=0)
   !return "<img:../../lib/resources/gregtech/textures/items/gt.integrated_circuit/"+$circuitNo+".png>"
!endfunction

'-----------Procedures-------------------------------------------
!procedure $drawNode($circuitNo=0)
    node "$getGTcircuitImage($circuitNo)" as test {
        [ %getenv("WORKDIR") - value]
    }
!endprocedure

!procedure $drawMachines()
    !$fullMachineName = $machineName+$machineNumber
    !$machines = %load_json("platline.json")
    !$machineNumber = 0
    !$inputNumber = 0
    !$outputNumber = 0
    !foreach $machine in $machines
        !$machineNumber = $machineNumber + 1
        !$fullMachineName = $machine.name + $machineNumber
        !$tier = $machine.tier
        !$circuit = $machine.circuit
        !$rectangleName = %string("rec"+$fullMachineName)
        rectangle " " as $fullMachineName {
            rectangle "$machine.name $getGTcircuitImage($circuit)" <<$tier>>  as $rectangleName  {
            }
            !foreach $input in $machine.inputs
                !$inputNumber = $inputNumber + 1
                !$portInName = %string("pi"+$inputNumber+$fullMachineName)
                !if ($DEBUG)
                    portin "$input.name\n$portInName" as $portInName
                !else
                    portin "$input.name" as $portInName
                !endif
                $portInName --# $rectangleName: $input.amount
            !endfor

            !foreach $output in $machine.outputs
                !$outputNumber = $outputNumber + 1
                !$portOutName = %string("po"+$outputNumber+$fullMachineName)
                !if ($DEBUG)
                    portout "$output.name\n$portOutName" as $portOutName
                !else
                    portout "$output.name" as $portOutName
                !endif
                $rectangleName #---- $portOutName: $output.amount
            !endfor
      }
    !endfor
!endprocedure

'-----------Draw Diagram Section---------------------------------

$drawMachines()

@enduml